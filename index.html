<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¢…í•©ì‹œí—˜ ì •ë³µê¸° â€” ë¹„êµì •ì¹˜ ë°°í‹€</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=IBM+Plex+Mono:wght@400;600&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --bg2: #13161e;
    --bg3: #1a1e28;
    --border: #2a2f3e;
    --gold: #c9a84c;
    --gold2: #e8c96b;
    --red: #e05252;
    --green: #52c078;
    --blue: #4a90d9;
    --text: #dde4f0;
    --muted: #7a85a0;
    --accent: #8b5cf6;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Serif KR', serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  /* Background grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(rgba(201,168,76,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(201,168,76,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .screen { position: relative; z-index: 1; }

  /* ===== START SCREEN ===== */
  #start-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 40px 20px;
  }
  .title-block {
    text-align: center;
    margin-bottom: 50px;
  }
  .badge {
    display: inline-block;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--gold);
    border: 1px solid var(--gold);
    padding: 4px 12px;
    letter-spacing: 3px;
    margin-bottom: 20px;
    text-transform: uppercase;
  }
  h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2rem, 6vw, 4rem);
    color: var(--text);
    line-height: 1.1;
    margin-bottom: 10px;
  }
  h1 span { color: var(--gold); }
  .subtitle {
    font-size: 14px;
    color: var(--muted);
    font-style: italic;
    letter-spacing: 1px;
  }
  .stats-bar {
    display: flex;
    gap: 30px;
    margin-bottom: 40px;
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 16px 30px;
    border-radius: 4px;
  }
  .stat { text-align: center; }
  .stat-val {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 24px;
    color: var(--gold);
    font-weight: 600;
  }
  .stat-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 4px;
  }
  .topic-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 14px;
    max-width: 800px;
    width: 100%;
    margin-bottom: 30px;
  }
  .topic-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 20px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }
  .topic-card::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 2px;
    background: var(--gold);
    transform: scaleX(0);
    transition: transform 0.2s;
  }
  .topic-card:hover { border-color: var(--gold); background: var(--bg3); }
  .topic-card:hover::after { transform: scaleX(1); }
  .topic-card.selected { border-color: var(--gold); background: var(--bg3); }
  .topic-card.selected::after { transform: scaleX(1); }
  .topic-icon { font-size: 28px; margin-bottom: 10px; }
  .topic-name { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
  .topic-desc { font-size: 11px; color: var(--muted); line-height: 1.5; }
  .topic-level {
    position: absolute;
    top: 10px; right: 10px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    color: var(--gold);
    background: rgba(201,168,76,0.1);
    padding: 2px 6px;
    border-radius: 2px;
  }
  .mode-row {
    display: flex; gap: 14px;
    max-width: 800px; width: 100%;
    margin-bottom: 30px;
  }
  .mode-btn {
    flex: 1;
    background: var(--bg2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 14px;
    cursor: pointer;
    font-family: 'Noto Serif KR', serif;
    font-size: 13px;
    transition: all 0.2s;
    display: flex; align-items: center; gap: 10px;
    justify-content: center;
  }
  .mode-btn:hover { border-color: var(--gold); color: var(--gold); }
  .mode-btn.active { border-color: var(--gold); background: rgba(201,168,76,0.1); color: var(--gold); }
  .start-btn {
    background: var(--gold);
    color: #0d0f14;
    border: none;
    padding: 18px 60px;
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.2s;
    margin-bottom: 20px;
  }
  .start-btn:hover { background: var(--gold2); transform: translateY(-2px); }
  .start-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  /* ===== GAME SCREEN ===== */
  #game-screen {
    display: none;
    min-height: 100vh;
    padding: 20px;
    max-width: 900px;
    margin: 0 auto;
  }
  .hud {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding: 14px 20px;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 4px;
  }
  .hud-topic {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: var(--gold);
    text-transform: uppercase;
    letter-spacing: 2px;
    flex: 1;
  }
  .hud-stat { display: flex; align-items: center; gap: 6px; font-size: 13px; }
  .hud-icon { font-size: 16px; }
  .streak-display {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    color: #ff9f43;
    font-weight: 600;
  }
  .score-display {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 15px;
    color: var(--gold);
    font-weight: 600;
  }
  .progress-bar {
    width: 100%;
    height: 4px;
    background: var(--border);
    margin-bottom: 30px;
    border-radius: 2px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), var(--gold2));
    transition: width 0.5s ease;
    border-radius: 2px;
  }

  .q-number {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 12px;
  }
  .q-difficulty {
    display: inline-block;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 2px;
    margin-bottom: 20px;
  }
  .q-difficulty.easy { background: rgba(82,192,120,0.15); color: var(--green); }
  .q-difficulty.medium { background: rgba(74,144,217,0.15); color: var(--blue); }
  .q-difficulty.hard { background: rgba(139,92,246,0.15); color: var(--accent); }
  .question-text {
    font-size: clamp(16px, 2.5vw, 20px);
    line-height: 1.7;
    margin-bottom: 12px;
    color: var(--text);
  }
  .keyword-tag {
    display: inline-block;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    border: 1px solid var(--border);
    padding: 2px 8px;
    margin-bottom: 30px;
    border-radius: 2px;
  }

  .options { display: flex; flex-direction: column; gap: 12px; }
  .option-btn {
    background: var(--bg2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 18px 24px;
    text-align: left;
    cursor: pointer;
    font-family: 'Noto Serif KR', serif;
    font-size: 14px;
    line-height: 1.6;
    transition: all 0.15s;
    display: flex; align-items: flex-start; gap: 14px;
    border-radius: 4px;
  }
  .option-btn:hover:not(:disabled) { border-color: var(--gold); background: var(--bg3); }
  .option-letter {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: var(--muted);
    min-width: 20px;
    font-weight: 600;
    margin-top: 2px;
  }
  .option-btn.correct { border-color: var(--green); background: rgba(82,192,120,0.1); }
  .option-btn.wrong { border-color: var(--red); background: rgba(224,82,82,0.1); }
  .option-btn.correct .option-letter { color: var(--green); }
  .option-btn.wrong .option-letter { color: var(--red); }

  .feedback-box {
    margin-top: 24px;
    padding: 20px 24px;
    background: var(--bg3);
    border-left: 3px solid var(--gold);
    display: none;
    animation: slideIn 0.3s ease;
  }
  @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .feedback-title {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 10px;
  }
  .feedback-title.correct { color: var(--green); }
  .feedback-title.wrong { color: var(--red); }
  .feedback-text { font-size: 14px; color: var(--text); line-height: 1.7; }
  .feedback-scholar {
    margin-top: 10px;
    font-size: 12px;
    color: var(--muted);
    font-style: italic;
  }

  .next-btn {
    margin-top: 20px;
    background: transparent;
    border: 1px solid var(--gold);
    color: var(--gold);
    padding: 14px 40px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.2s;
    display: none;
  }
  .next-btn:hover { background: var(--gold); color: #0d0f14; }

  /* Loading */
  .loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 80px 20px;
  }
  .loading-spinner {
    width: 50px; height: 50px;
    border: 2px solid var(--border);
    border-top-color: var(--gold);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  .loading-dots::after {
    content: '';
    animation: dots 1.5s infinite;
  }
  @keyframes dots {
    0% { content: ''; }
    33% { content: '.'; }
    66% { content: '..'; }
    100% { content: '...'; }
  }

  /* ===== RESULT SCREEN ===== */
  #result-screen {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 40px 20px;
    text-align: center;
  }
  .result-grade {
    font-family: 'Playfair Display', serif;
    font-size: clamp(60px, 15vw, 100px);
    font-weight: 700;
    line-height: 1;
    margin-bottom: 10px;
  }
  .result-label {
    font-size: 14px;
    color: var(--muted);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 40px;
    font-style: italic;
  }
  .result-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    max-width: 500px;
    width: 100%;
    margin-bottom: 40px;
  }
  .result-stat {
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 20px;
  }
  .result-stat-val {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 28px;
    font-weight: 600;
    color: var(--gold);
  }
  .result-stat-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 6px;
  }
  .comment-box {
    max-width: 500px;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-left: 3px solid var(--gold);
    padding: 20px 24px;
    text-align: left;
    margin-bottom: 30px;
    font-size: 14px;
    line-height: 1.7;
    color: var(--text);
    font-style: italic;
  }
  .result-actions { display: flex; gap: 14px; }
  .action-btn {
    padding: 14px 30px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid var(--gold);
  }
  .action-btn.primary { background: var(--gold); color: #0d0f14; border-color: var(--gold); }
  .action-btn.secondary { background: transparent; color: var(--gold); }
  .action-btn:hover { transform: translateY(-2px); }

  /* XP pop animation */
  .xp-pop {
    position: fixed;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 20px;
    font-weight: 600;
    color: var(--gold);
    pointer-events: none;
    z-index: 1000;
    animation: xpFloat 1.5s ease-out forwards;
  }
  @keyframes xpFloat {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    100% { opacity: 0; transform: translateY(-80px) scale(1.3); }
  }

  .error-msg {
    background: rgba(224,82,82,0.1);
    border: 1px solid var(--red);
    color: var(--red);
    padding: 16px 20px;
    font-size: 13px;
    margin-top: 20px;
    text-align: center;
    border-radius: 4px;
  }

  /* Decorative lines */
  .divider {
    width: 60px; height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    margin: 20px auto;
  }
  
  .back-btn {
    background: transparent;
    border: none;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    letter-spacing: 1px;
    cursor: pointer;
    padding: 8px;
    margin-right: auto;
    display: flex; align-items: center; gap: 6px;
    transition: color 0.2s;
  }
  .back-btn:hover { color: var(--text); }

  /* ===== ì˜¤ë‹µë…¸íŠ¸ ===== */
  #notebook-screen {
    display: none;
    min-height: 100vh;
    padding: 30px 20px;
    max-width: 900px;
    margin: 0 auto;
  }
  .notebook-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }
  .notebook-title {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    color: var(--text);
    flex: 1;
  }
  .notebook-title span { color: var(--red); }
  .notebook-count {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    color: var(--muted);
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 6px 14px;
  }
  .notebook-tabs {
    display: flex;
    gap: 0;
    margin-bottom: 24px;
    border-bottom: 1px solid var(--border);
  }
  .nb-tab {
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 10px 20px;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: -1px;
  }
  .nb-tab.active { color: var(--red); border-bottom-color: var(--red); }
  .nb-tab:hover:not(.active) { color: var(--text); }
  .notebook-filter {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  .filter-chip {
    background: var(--bg2);
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    padding: 5px 12px;
    cursor: pointer;
    transition: all 0.2s;
    border-radius: 20px;
  }
  .filter-chip.active { border-color: var(--gold); color: var(--gold); background: rgba(201,168,76,0.1); }
  .filter-chip:hover:not(.active) { border-color: var(--text); color: var(--text); }
  .notebook-list { display: flex; flex-direction: column; gap: 16px; }
  .note-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-left: 3px solid var(--red);
    border-radius: 4px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .note-card.mastered { border-left-color: var(--green); }
  .note-card-header {
    padding: 16px 20px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    cursor: pointer;
    user-select: none;
  }
  .note-card-header:hover { background: var(--bg3); }
  .note-meta {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
  }
  .note-topic-badge {
    display: inline-block;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    background: var(--bg3);
    padding: 2px 8px;
    border-radius: 2px;
    align-self: flex-start;
    margin-bottom: 4px;
  }
  .note-question {
    font-size: 14px;
    line-height: 1.6;
    color: var(--text);
    font-weight: 700;
  }
  .note-date {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    margin-top: 4px;
  }
  .note-toggle {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 16px;
    color: var(--muted);
    min-width: 20px;
    text-align: center;
    transition: transform 0.2s;
  }
  .note-card.open .note-toggle { transform: rotate(180deg); }
  .note-body {
    display: none;
    padding: 0 20px 20px;
    border-top: 1px solid var(--border);
    animation: slideIn 0.2s ease;
  }
  .note-card.open .note-body { display: block; }
  .note-section {
    margin-top: 16px;
  }
  .note-section-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 8px;
  }
  .note-my-answer {
    background: rgba(224,82,82,0.08);
    border: 1px solid rgba(224,82,82,0.3);
    padding: 10px 14px;
    font-size: 13px;
    color: var(--red);
    border-radius: 3px;
    line-height: 1.5;
  }
  .note-correct-answer {
    background: rgba(82,192,120,0.08);
    border: 1px solid rgba(82,192,120,0.3);
    padding: 10px 14px;
    font-size: 13px;
    color: var(--green);
    border-radius: 3px;
    line-height: 1.5;
  }
  .note-explanation {
    font-size: 13px;
    color: var(--text);
    line-height: 1.7;
    padding: 10px 0;
  }
  .note-analysis {
    background: rgba(139,92,246,0.08);
    border: 1px solid rgba(139,92,246,0.3);
    padding: 12px 14px;
    font-size: 13px;
    color: #c4b5fd;
    border-radius: 3px;
    line-height: 1.6;
    display: none;
  }
  .note-analysis.loaded { display: block; }
  .note-analysis-loading {
    display: flex; align-items: center; gap: 8px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    padding: 10px 0;
  }
  .mini-spinner {
    width: 14px; height: 14px;
    border: 1px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    flex-shrink: 0;
  }
  .note-actions {
    display: flex; gap: 8px; margin-top: 14px;
    flex-wrap: wrap;
  }
  .note-action-btn {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    padding: 7px 14px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
    border-radius: 2px;
  }
  .note-action-btn:hover { border-color: var(--text); color: var(--text); }
  .note-action-btn.analyze { border-color: var(--accent); color: var(--accent); }
  .note-action-btn.analyze:hover { background: rgba(139,92,246,0.1); }
  .note-action-btn.mastered-btn { border-color: var(--green); color: var(--green); }
  .note-action-btn.mastered-btn:hover { background: rgba(82,192,120,0.1); }
  .note-action-btn.delete-btn:hover { border-color: var(--red); color: var(--red); }
  .empty-notebook {
    text-align: center;
    padding: 80px 20px;
    color: var(--muted);
  }
  .empty-notebook .empty-icon { font-size: 50px; margin-bottom: 16px; }
  .empty-notebook .empty-title { font-size: 18px; color: var(--text); margin-bottom: 8px; }
  .empty-notebook .empty-desc { font-size: 13px; line-height: 1.6; }
  .notebook-actions-row {
    display: flex; gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  .nb-action-btn {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    padding: 8px 16px;
    border: 1px solid var(--border);
    background: var(--bg2);
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
  }
  .nb-action-btn:hover { border-color: var(--gold); color: var(--gold); }
  .retry-wrong-btn {
    background: rgba(224,82,82,0.1);
    border-color: var(--red);
    color: var(--red);
  }
  .retry-wrong-btn:hover { background: rgba(224,82,82,0.2); }
  
  /* Notebook button on start screen */
  .notebook-open-btn {
    position: fixed;
    top: 20px; right: 20px;
    background: var(--bg2);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    letter-spacing: 1px;
    padding: 10px 16px;
    cursor: pointer;
    transition: all 0.2s;
    z-index: 100;
    display: flex; align-items: center; gap: 8px;
  }
  .notebook-open-btn:hover { border-color: var(--red); color: var(--red); }
  .notebook-badge {
    background: var(--red);
    color: white;
    font-size: 10px;
    border-radius: 10px;
    padding: 1px 6px;
    min-width: 18px;
    text-align: center;
  }
  .streak-flame {
    display: inline-block;
    animation: flame 0.6s ease-in-out infinite alternate;
  }
  @keyframes flame {
    from { transform: scale(1) rotate(-5deg); }
    to { transform: scale(1.2) rotate(5deg); }
  }
</style>
</head>
<body>

<!-- Floating notebook button -->
<button class="notebook-open-btn" id="notebook-float-btn" onclick="showNotebook()">
  ğŸ““ ì˜¤ë‹µë…¸íŠ¸ <span class="notebook-badge" id="notebook-badge">0</span>
</button>

<!-- START SCREEN -->
<div id="start-screen" class="screen">
  <div class="title-block">
    <div class="badge">ì¢…í•©ì‹œí—˜ ëŒ€ë¹„</div>
    <h1>ë¹„êµì •ì¹˜ <span>ë°°í‹€</span></h1>
    <div class="subtitle">ì •ì¹˜í•™ ì¢…í•©ì‹œí—˜ ì •ë³µì„ ìœ„í•œ ê²Œì„í˜• í•™ìŠµ</div>
  </div>

  <div class="stats-bar">
    <div class="stat">
      <div class="stat-val" id="total-score">0</div>
      <div class="stat-label">ì´ XP</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="total-correct">0</div>
      <div class="stat-label">ì •ë‹µ ìˆ˜</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="best-streak">0</div>
      <div class="stat-label">ìµœê³  ì—°ì†</div>
    </div>
  </div>

  <div class="topic-grid" id="topic-grid">
    <div class="topic-card" data-topic="ë¯¼ì£¼ì£¼ì˜ê¸°ì´ˆ">
      <div class="topic-level">CORE</div>
      <div class="topic-icon">ğŸ›ï¸</div>
      <div class="topic-name">ë¯¼ì£¼ì£¼ì˜ ê¸°ì´ˆ</div>
      <div class="topic-desc">Dahl, í´ë¦¬ì•„í‚¤, ë¯¼ì£¼ì£¼ì˜ ê¸°ì›, í† í¬ë¹Œ, í”„ë¥´ì œë³´ë¥´ìŠ¤í‚¤</div>
    </div>
    <div class="topic-card" data-topic="ì„ ê±°ì œë„ì™€ì •ë‹¹ì²´ì œ">
      <div class="topic-level">HIGH</div>
      <div class="topic-icon">ğŸ—³ï¸</div>
      <div class="topic-name">ì„ ê±°ì œë„ & ì •ë‹¹ì²´ì œ</div>
      <div class="topic-desc">ë’¤ë² ë¥´ì œì˜ ë²•ì¹™, ê¸°ê³„ì Â·ì‹¬ë¦¬ì  íš¨ê³¼, íŒŒí¸ì„±, ë¹„ë¡€ëŒ€í‘œì œ</div>
    </div>
    <div class="topic-card" data-topic="ë¯¼ì£¼ì£¼ì˜í‡´í–‰">
      <div class="topic-level">HIGH</div>
      <div class="topic-icon">ğŸ“‰</div>
      <div class="topic-name">ë¯¼ì£¼ì£¼ì˜ í‡´í–‰</div>
      <div class="topic-desc">Bermeo, í–‰ì •ë ¥ ê°•í™”, í¬í“°ë¦¬ì¦˜, ì–‘ê·¹í™”, ë¯¼ì£¼í™” ì´ë¡ </div>
    </div>
    <div class="topic-card" data-topic="ì •ì¹˜ì œë„">
      <div class="topic-level">CORE</div>
      <div class="topic-icon">âš–ï¸</div>
      <div class="topic-name">ì •ì¹˜ì œë„ë¡ </div>
      <div class="topic-desc">ì‹ Â·êµ¬ì œë„ì£¼ì˜, ì—­ì‚¬ì Â·í•©ë¦¬ì  ì„ íƒ ì œë„ì£¼ì˜, ê±°ë¶€ê¶Œ í–‰ìœ„ì</div>
    </div>
    <div class="topic-card" data-topic="ë¹„êµê¶Œìœ„ì£¼ì˜">
      <div class="topic-level">ADV</div>
      <div class="topic-icon">ğŸ‘ï¸</div>
      <div class="topic-name">ë¹„êµê¶Œìœ„ì£¼ì˜</div>
      <div class="topic-desc">ê¶Œìœ„ì£¼ì˜ ìœ í˜•, ë‚´êµ¬ì„±, ì„ ê±°ê¶Œìœ„ì£¼ì˜, í˜¼í•©ì²´ì œ</div>
    </div>
    <div class="topic-card" data-topic="ë¯¼ì£¼í™”ì´ë¡ ">
      <div class="topic-level">ADV</div>
      <div class="topic-icon">ğŸŒ±</div>
      <div class="topic-name">ë¯¼ì£¼í™” ì´ë¡ </div>
      <div class="topic-desc">ëª¨ë”ë‹ˆì œì´ì…˜, ì—˜ë¦¬íŠ¸ í˜‘ì•½, ì‚¬íšŒêµ¬ì¡°ì  ì ‘ê·¼, ì œ3ë¬¼ê²°</div>
    </div>
  </div>

  <div class="mode-row">
    <button class="mode-btn active" data-mode="quiz" id="mode-quiz">ğŸ“ &nbsp;ê°ê´€ì‹ í€´ì¦ˆ</button>
    <button class="mode-btn" data-mode="hard" id="mode-hard">ğŸ”¥ &nbsp;í•˜ë“œëª¨ë“œ (ì–´ë ¤ìš´ ë¬¸ì œ)</button>
    <button class="mode-btn" data-mode="exam" id="mode-exam">ğŸ“‹ &nbsp;ê¸°ì¶œ ìŠ¤íƒ€ì¼</button>
  </div>

  <button class="start-btn" id="start-btn" disabled>ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”</button>
  <div style="font-size:12px; color:var(--muted); font-family:'IBM Plex Mono',monospace;">10ë¬¸í•­ Â· AI ì‹¤ì‹œê°„ ìƒì„± Â· í•™ìŠµìë£Œ ê¸°ë°˜</div>
</div>

<!-- GAME SCREEN -->
<div id="game-screen" class="screen">
  <div class="hud">
    <button class="back-btn" onclick="goHome()">â† í™ˆ</button>
    <div class="hud-topic" id="hud-topic">ë¯¼ì£¼ì£¼ì˜</div>
    <div class="hud-stat">
      <span class="hud-icon">ğŸ”¥</span>
      <span class="streak-display" id="streak">0</span>
    </div>
    <div class="hud-stat">
      <span class="hud-icon">â­</span>
      <span class="score-display" id="score">0 XP</span>
    </div>
  </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill" style="width:0%"></div>
  </div>

  <div id="question-area"></div>
</div>

<!-- RESULT SCREEN -->
<div id="result-screen" class="screen">
  <div class="result-grade" id="result-grade">A+</div>
  <div class="result-label" id="result-label">Distinction</div>
  <div class="divider"></div>
  <div class="result-stats">
    <div class="result-stat">
      <div class="result-stat-val" id="r-correct">-</div>
      <div class="result-stat-label">ì •ë‹µ</div>
    </div>
    <div class="result-stat">
      <div class="result-stat-val" id="r-score">-</div>
      <div class="result-stat-label">XP íšë“</div>
    </div>
    <div class="result-stat">
      <div class="result-stat-val" id="r-streak">-</div>
      <div class="result-stat-label">ìµœê³  ì—°ì†</div>
    </div>
  </div>
  <div class="comment-box" id="result-comment"></div>
  <div class="result-actions">
    <button class="action-btn secondary" onclick="goHome()">â† ë‹¤ë¥¸ ì£¼ì œ</button>
    <button class="action-btn secondary" onclick="showNotebook()" style="border-color:var(--red);color:var(--red);">ğŸ““ ì˜¤ë‹µë…¸íŠ¸</button>
    <button class="action-btn primary" onclick="restartGame()">ë‹¤ì‹œ ë„ì „</button>
  </div>
</div>

<!-- NOTEBOOK SCREEN -->
<div id="notebook-screen" class="screen">
  <div class="notebook-header">
    <button class="back-btn" onclick="goHome()">â† í™ˆ</button>
    <div class="notebook-title">ì˜¤ë‹µ <span>ë…¸íŠ¸</span></div>
    <div class="notebook-count" id="nb-count">0ê°œ</div>
  </div>
  <div class="notebook-tabs">
    <button class="nb-tab active" data-tab="all" onclick="switchNbTab('all', this)">ì „ì²´</button>
    <button class="nb-tab" data-tab="wrong" onclick="switchNbTab('wrong', this)">ë¯¸ìˆ™ì§€</button>
    <button class="nb-tab" data-tab="mastered" onclick="switchNbTab('mastered', this)">ì™„ì „ìˆ™ì§€ âœ“</button>
  </div>
  <div class="notebook-filter" id="nb-filter"></div>
  <div class="notebook-actions-row">
    <button class="nb-action-btn retry-wrong-btn" onclick="retryWrong()">ğŸ” ì˜¤ë‹µë§Œ ë‹¤ì‹œ í’€ê¸°</button>
    <button class="nb-action-btn" onclick="clearMastered()">âœ“ ì™„ì „ìˆ™ì§€ ì´ˆê¸°í™”</button>
    <button class="nb-action-btn" onclick="clearAllNotes()" style="color:var(--red);border-color:var(--red)">ğŸ—‘ ì „ì²´ ì‚­ì œ</button>
  </div>
  <div class="notebook-list" id="notebook-list"></div>
</div>

<script>
// ====== NOTEBOOK DATA ======
let wrongNotes = JSON.parse(localStorage.getItem('wrongNotes') || '[]');
let currentNbTab = 'all';
let currentNbFilter = 'all';

const topicLabels = {
  'ë¯¼ì£¼ì£¼ì˜ê¸°ì´ˆ': 'ë¯¼ì£¼ì£¼ì˜ ê¸°ì´ˆ',
  'ì„ ê±°ì œë„ì™€ì •ë‹¹ì²´ì œ': 'ì„ ê±°ì œë„ & ì •ë‹¹ì²´ì œ',
  'ë¯¼ì£¼ì£¼ì˜í‡´í–‰': 'ë¯¼ì£¼ì£¼ì˜ í‡´í–‰',
  'ì •ì¹˜ì œë„': 'ì •ì¹˜ì œë„ë¡ ',
  'ë¹„êµê¶Œìœ„ì£¼ì˜': 'ë¹„êµê¶Œìœ„ì£¼ì˜',
  'ë¯¼ì£¼í™”ì´ë¡ ': 'ë¯¼ì£¼í™” ì´ë¡ '
};

function saveWrongAnswer(q, myIdx, topic) {
  const note = {
    id: Date.now() + Math.random(),
    topic: topic,
    question: q.question,
    keyword: q.keyword,
    difficulty: q.difficulty,
    scholar: q.scholar,
    options: q.options,
    correctIdx: q.correct,
    myIdx: myIdx,
    explanation: q.explanation,
    date: new Date().toLocaleDateString('ko-KR'),
    mastered: false,
    analysis: null
  };
  wrongNotes.unshift(note);
  // Keep max 100 notes
  if (wrongNotes.length > 100) wrongNotes = wrongNotes.slice(0, 100);
  localStorage.setItem('wrongNotes', JSON.stringify(wrongNotes));
  updateNotebookBadge();
}

function updateNotebookBadge() {
  const unmastered = wrongNotes.filter(n => !n.mastered).length;
  document.getElementById('notebook-badge').textContent = unmastered;
}

function showNotebook() {
  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('game-screen').style.display = 'none';
  document.getElementById('result-screen').style.display = 'none';
  document.getElementById('notebook-screen').style.display = 'block';
  renderNotebook();
}

function switchNbTab(tab, el) {
  currentNbTab = tab;
  document.querySelectorAll('.nb-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  renderNotebook();
}

function renderNotebook() {
  // Filter chips
  const topics = [...new Set(wrongNotes.map(n => n.topic))];
  const filterDiv = document.getElementById('nb-filter');
  filterDiv.innerHTML = `
    <button class="filter-chip ${currentNbFilter === 'all' ? 'active' : ''}" onclick="setNbFilter('all')">ì „ì²´ ì£¼ì œ</button>
    ${topics.map(t => `<button class="filter-chip ${currentNbFilter === t ? 'active' : ''}" onclick="setNbFilter('${t}')">${topicLabels[t] || t}</button>`).join('')}
  `;

  let filtered = wrongNotes;
  if (currentNbFilter !== 'all') filtered = filtered.filter(n => n.topic === currentNbFilter);
  if (currentNbTab === 'wrong') filtered = filtered.filter(n => !n.mastered);
  if (currentNbTab === 'mastered') filtered = filtered.filter(n => n.mastered);

  document.getElementById('nb-count').textContent = `${wrongNotes.filter(n=>!n.mastered).length}ê°œ ë¯¸ìˆ™ì§€`;

  const list = document.getElementById('notebook-list');
  if (filtered.length === 0) {
    list.innerHTML = `
      <div class="empty-notebook">
        <div class="empty-icon">${currentNbTab === 'mastered' ? 'ğŸ‰' : 'ğŸ“'}</div>
        <div class="empty-title">${currentNbTab === 'mastered' ? 'ì™„ì „ìˆ™ì§€ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤' : 'ì˜¤ë‹µ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤'}</div>
        <div class="empty-desc">${currentNbTab === 'mastered' ? 'í‹€ë¦° ë¬¸ì œë¥¼ ë³µìŠµí•˜ê³  ì™„ì „ìˆ™ì§€ ì²˜ë¦¬í•´ë³´ì„¸ìš”!' : 'ê²Œì„ì„ í”Œë ˆì´í•˜ë©´ í‹€ë¦° ë¬¸ì œê°€ ìë™ìœ¼ë¡œ ì—¬ê¸° ì €ì¥ë©ë‹ˆë‹¤.'}</div>
      </div>
    `;
    return;
  }

  const letters = ['A', 'B', 'C', 'D'];
  const diffMap = { easy: 'ê¸°ì´ˆ', medium: 'ì¤‘ê¸‰', hard: 'ì‹¬í™”' };

  list.innerHTML = filtered.map((note, i) => `
    <div class="note-card ${note.mastered ? 'mastered' : ''}" id="note-${note.id}">
      <div class="note-card-header" onclick="toggleNote('${note.id}')">
        <div class="note-meta">
          <span class="note-topic-badge">${topicLabels[note.topic] || note.topic} Â· ${diffMap[note.difficulty] || note.difficulty}</span>
          <div class="note-question">${note.question}</div>
          <div class="note-date">ğŸ—“ ${note.date} Â· # ${note.keyword} ${note.mastered ? 'Â· âœ“ ì™„ì „ìˆ™ì§€' : ''}</div>
        </div>
        <span class="note-toggle">â–¼</span>
      </div>
      <div class="note-body" id="body-${note.id}">
        <div class="note-section">
          <div class="note-section-label">âŒ ë‚´ê°€ ì„ íƒí•œ ë‹µ</div>
          <div class="note-my-answer">${letters[note.myIdx]}. ${note.options[note.myIdx]}</div>
        </div>
        <div class="note-section">
          <div class="note-section-label">âœ… ì •ë‹µ</div>
          <div class="note-correct-answer">${letters[note.correctIdx]}. ${note.options[note.correctIdx]}</div>
        </div>
        <div class="note-section">
          <div class="note-section-label">ğŸ“– í•´ì„¤ ${note.scholar ? 'â€” ' + note.scholar : ''}</div>
          <div class="note-explanation">${note.explanation}</div>
        </div>
        <div class="note-section">
          <div class="note-section-label">ğŸ” AI ì˜¤ë‹µ ë¶„ì„</div>
          <div id="analysis-${note.id}" class="note-analysis ${note.analysis ? 'loaded' : ''}">${note.analysis || ''}</div>
          ${!note.analysis ? `<div class="note-analysis-loading" id="anlod-${note.id}" style="display:none"><div class="mini-spinner"></div>ë¶„ì„ ì¤‘...</div>` : ''}
        </div>
        <div class="note-actions">
          ${!note.analysis ? `<button class="note-action-btn analyze" onclick="analyzeWrong('${note.id}')">ğŸ” ì™œ í‹€ë ¸ëŠ”ì§€ ë¶„ì„</button>` : ''}
          ${!note.mastered ? `<button class="note-action-btn mastered-btn" onclick="markMastered('${note.id}')">âœ“ ì™„ì „ìˆ™ì§€ ì²˜ë¦¬</button>` : '<span style="font-size:12px;color:var(--green);font-family:\'IBM Plex Mono\',monospace;">âœ“ ì™„ì „ìˆ™ì§€ ì™„ë£Œ</span>'}
          <button class="note-action-btn delete-btn" onclick="deleteNote('${note.id}')">ì‚­ì œ</button>
        </div>
      </div>
    </div>
  `).join('');
}

function setNbFilter(f) {
  currentNbFilter = f;
  renderNotebook();
}

function toggleNote(id) {
  const card = document.getElementById(`note-${id}`);
  card.classList.toggle('open');
}

async function analyzeWrong(id) {
  const note = wrongNotes.find(n => String(n.id) === String(id));
  if (!note) return;

  const letters = ['A', 'B', 'C', 'D'];
  const loadEl = document.getElementById(`anlod-${id}`);
  const analysisEl = document.getElementById(`analysis-${id}`);
  
  if (loadEl) loadEl.style.display = 'flex';
  
  const prompt = `ì •ì¹˜í•™ ì¢…í•©ì‹œí—˜ í•™ìŠµìê°€ ë‹¤ìŒ ë¬¸ì œë¥¼ í‹€ë ¸ìŠµë‹ˆë‹¤. ì™œ ì´ ì˜¤ë‹µì„ ì„ íƒí–ˆëŠ”ì§€, ì–´ë–¤ ê°œë…ì„ í—·ê°ˆë¦° ê²ƒì¸ì§€, ì˜¬ë°”ë¥¸ ì´í•´ë¥¼ ìœ„í•´ ë¬´ì—‡ì„ ê³µë¶€í•´ì•¼ í•˜ëŠ”ì§€ í•œêµ­ì–´ë¡œ ê°„ê²°í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš” (3-4ë¬¸ì¥).

ë¬¸ì œ: ${note.question}

ì„ íƒì§€:
${note.options.map((o, i) => `${letters[i]}. ${o}`).join('\n')}

í•™ìŠµì ì„ íƒ (ì˜¤ë‹µ): ${letters[note.myIdx]}. ${note.options[note.myIdx]}
ì •ë‹µ: ${letters[note.correctIdx]}. ${note.options[note.correctIdx]}

í•´ì„¤: ${note.explanation}

ê´€ë ¨ í•™ì: ${note.scholar || 'ì—†ìŒ'}

ë¶„ì„ í˜•ì‹: ì§ì ‘ì ì´ê³  êµ¬ì²´ì ìœ¼ë¡œ. "ì´ ë¬¸ì œì—ì„œ ~ë¥¼ ~ì™€ í˜¼ë™í•œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤" ì‹ìœ¼ë¡œ ì‹œì‘.`;

  try {
    const response = await fetch("/.netlify/functions/claude", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-5",
        max_tokens: 400,
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await response.json();
    const text = data.content.map(i => i.text || "").join("");
    
    note.analysis = text;
    localStorage.setItem('wrongNotes', JSON.stringify(wrongNotes));
    
    if (loadEl) loadEl.style.display = 'none';
    if (analysisEl) {
      analysisEl.textContent = text;
      analysisEl.classList.add('loaded');
    }
  } catch(e) {
    if (loadEl) loadEl.style.display = 'none';
    if (analysisEl) {
      analysisEl.textContent = 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      analysisEl.classList.add('loaded');
    }
  }
}

function markMastered(id) {
  const note = wrongNotes.find(n => String(n.id) === String(id));
  if (note) {
    note.mastered = true;
    localStorage.setItem('wrongNotes', JSON.stringify(wrongNotes));
    updateNotebookBadge();
    renderNotebook();
  }
}

function deleteNote(id) {
  wrongNotes = wrongNotes.filter(n => String(n.id) !== String(id));
  localStorage.setItem('wrongNotes', JSON.stringify(wrongNotes));
  updateNotebookBadge();
  renderNotebook();
}

function clearMastered() {
  wrongNotes = wrongNotes.filter(n => !n.mastered);
  localStorage.setItem('wrongNotes', JSON.stringify(wrongNotes));
  updateNotebookBadge();
  renderNotebook();
}

function clearAllNotes() {
  if (confirm('ì˜¤ë‹µë…¸íŠ¸ë¥¼ ì „ë¶€ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    wrongNotes = [];
    localStorage.setItem('wrongNotes', JSON.stringify(wrongNotes));
    updateNotebookBadge();
    renderNotebook();
  }
}

function retryWrong() {
  const unmastered = wrongNotes.filter(n => !n.mastered && (currentNbFilter === 'all' || n.topic === currentNbFilter));
  if (unmastered.length === 0) {
    alert('ë¯¸ìˆ™ì§€ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤! ğŸ‰');
    return;
  }
  // Pick topic from first unmastered or mixed
  const topics = [...new Set(unmastered.map(n => n.topic))];
  currentTopic = topics[0]; // use first topic as base
  retryQuestions = unmastered.slice(0, 10);
  startRetryGame();
}

// ====== RETRY WRONG ANSWERS MODE ======
let retryQuestions = [];
let isRetryMode = false;

function startRetryGame() {
  isRetryMode = true;
  score = 0;
  streak = 0;
  bestStreak = 0;
  correctCount = 0;
  currentQ = 0;
  questions = retryQuestions.map(n => ({
    question: n.question,
    difficulty: n.difficulty,
    keyword: n.keyword,
    options: n.options,
    correct: n.correctIdx,
    explanation: n.explanation,
    scholar: n.scholar
  }));
  totalQ = questions.length;
  answered = false;

  document.getElementById('notebook-screen').style.display = 'none';
  document.getElementById('game-screen').style.display = 'block';
  document.getElementById('hud-topic').textContent = 'ğŸ” ì˜¤ë‹µ ì¬ë„ì „';
  updateHUD();
  renderQuestion(questions[0]);
}
</script>

<script>
// ====== STATE ======
let currentTopic = null;
let currentMode = 'quiz';
let currentQ = 0;
let totalQ = 10;
let score = 0;
let streak = 0;
let bestStreak = 0;
let correctCount = 0;
let questions = [];
let answered = false;
let totalXP = parseInt(localStorage.getItem('totalXP') || '0');
let totalCorrect = parseInt(localStorage.getItem('totalCorrect') || '0');
let savedBestStreak = parseInt(localStorage.getItem('bestStreak') || '0');

// ====== STUDY CONTENT ======
const studyContent = {
  'ë¯¼ì£¼ì£¼ì˜ê¸°ì´ˆ': `
ë¡œë²„íŠ¸ ë‹¬(Robert Dahl)ì˜ ë¯¼ì£¼ì£¼ì˜ ì´ë¡ :
- í´ë¦¬ì•„í‚¤(Polyarchy): ì‹¤ì§ˆì  ë¯¼ì£¼ì£¼ì˜. ê²½ìŸ(Contestation)ê³¼ í¬ìš©(Inclusion)ì˜ ë‘ ì°¨ì›. 7ê°€ì§€ ì¡°ê±´: ì„ ì¶œëœ ê³µì§ì, ììœ ë¡­ê³  ê³µì •í•œ ì„ ê±°, í¬ê´„ì  ì°¸ì •ê¶Œ, í”¼ì„ ê±°ê¶Œ, ì–¸ë¡ ì˜ ììœ , ëŒ€ì•ˆì  ì •ë³´ ì ‘ê·¼, ê²°ì‚¬ì˜ ììœ 
- ë¯¼ì£¼ì£¼ì˜ ìµœì†Œ ê¸°ì¤€: ì„ ê±°ë¥¼ í†µí•œ ì •ê¶Œêµì²´ ê°€ëŠ¥ì„±
- ë¯¼ì£¼ì£¼ì˜ëŠ” 2,500ë…„ ì „ ê³ ëŒ€ ê·¸ë¦¬ìŠ¤ì—ì„œ ë°œëª…, ì§ì„ ì Â·í•„ì—°ì  ë°œì „ì´ ì•„ë‹Œ ìš°ì—°ì  ë°œì „ê³¼ í›„í‡´ ë°˜ë³µ
- ì•„í…Œë„¤ ë¯¼ì£¼ì£¼ì˜: ë¯¼íšŒ(assembly) ì¤‘ì‹¬, ì¶”ì²¨Â·ì œë¹„ë½‘ê¸°ë¡œ ê³µì§ì ì„ ì¶œ, ì§ì ‘ ë¯¼ì£¼ì£¼ì˜
- ë¡œë§ˆ ê³µí™”ì •: ê¸°ì›ì „ 130ë…„ê²½ ì´í›„ ì‹œë¯¼ì •ì‹  ì‡ í‡´ë¡œ ì•½í™”, ëŒ€ì˜ì œ ì±„íƒ ì•ˆ í•¨

í† í¬ë¹Œ(Tocqueville), ì•™ì‹œì—¥ ë ˆì§ê³¼ í”„ë‘ìŠ¤ í˜ëª…:
- ë‹¨ì ˆë¡  ë¹„íŒ: í”„ë‘ìŠ¤ í˜ëª…ì€ ì´ì „ ìœ ì‚°ê³¼ ì™„ì „íˆ ë‹¨ì ˆë˜ì§€ ì•ŠìŒ, ì—°ì†ì  ì—­ì‚¬
- ì¤‘ì•™ì§‘ê¶Œí™”ëŠ” í˜ëª…ì˜ ê²°ê³¼ê°€ ì•„ë‹Œ ì•™ì‹œì—¥ ë ˆì§ì˜ ì‚°ë¬¼
- ë¶ˆí‰ë“±ì´ í”„ë‘ìŠ¤ í˜ëª…ì˜ ê·¼ë³¸ ì›ì¸
- í”„ë‘ìŠ¤ í˜ëª… = "ì´ìƒí•œ ì¢…êµ": ë³´í¸ì  ê°€ì¹˜(í‰ë“±, êµ­ë¯¼ì£¼ê¶Œ) ì „íŒŒ ì§€í–¥

í”„ë¥´ì œë³´ë¥´ìŠ¤í‚¤(Przeworski) ë¯¼ì£¼ì£¼ì˜ì™€ ë°œì „:
- ì†Œë“ìˆ˜ì¤€ê³¼ ë¯¼ì£¼ì£¼ì˜ ê´€ê³„ ë¶„ì„
- ë¯¼ì£¼ì£¼ì˜ëŠ” ê²½ì œ ë°œì „ì˜ ì›ì¸ì´ ì•„ë‹Œ ê²°ê³¼ì¼ ìˆ˜ ìˆìŒ
- ë¶€ìœ í•œ êµ­ê°€ì—ì„œ ë¯¼ì£¼ì£¼ì˜ê°€ ë” ì˜¤ë˜ ì§€ì†ë¨(ë‚´êµ¬ì„±)

ë§¨ì»¤ ì˜¬ìŠ¨(Mancur Olson):
- ë…ì¬ì™€ ë¯¼ì£¼ì£¼ì˜, ë°œì „: ì •ì°©í•œ ê°•ë„(stationary bandit) vs ë– ëŒì´ ê°•ë„(roving bandit)
- ë…ì¬ìë„ ì‚¬íšŒ ë°œì „ì— ê´€ì‹¬ ê°€ì§(ì„¸ê¸ˆ ê¸°ë°˜ ìœ ì§€)
- ë¯¼ì£¼ì£¼ì˜: ë‹¤ìˆ˜ì˜ ì´ìµ ëŒ€ë³€, ì¬ì‚°ê¶Œ ë³´í˜¸ ê°•ì¡°
`,

  'ì„ ê±°ì œë„ì™€ì •ë‹¹ì²´ì œ': `
ë’¤ë² ë¥´ì œì˜ ë²•ì¹™(Duverger's Law):
- ì†Œì„ ê±°êµ¬ ë‹¨ìˆœë‹¤ìˆ˜ëŒ€í‘œì œ(SMDP): ì–‘ë‹¹ì œ ê²½í–¥
- ë¹„ë¡€ëŒ€í‘œì œ(PR): ë‹¤ë‹¹ì œ ê²½í–¥
- ê¸°ê³„ì  íš¨ê³¼(Mechanical Effect): ìŠ¹ìë…ì‹ êµ¬ì¡°ë¡œ ì†Œìˆ˜ì •ë‹¹ ì˜ì„ íšë“ ì–´ë ¤ì›€
- ì‹¬ë¦¬ì  íš¨ê³¼(Psychological Effect): ìœ ê¶Œìì˜ ì‚¬í‘œ ë°©ì§€ ì „ëµ â†’ ì£¼ìš” ì •ë‹¹ì— í‘œ ì§‘ì¤‘

ì •ë‹¹ì²´ì œ íŒŒí¸ì„±(Fragmentation):
- ìœ íš¨ì •ë‹¹ìˆ˜(Effective Number of Parties, ENP)ë¡œ ì¸¡ì •
- íŒŒí¸ì„± â†‘ â†’ ì±…ì„ì„± â†“, ì‘ë‹µì„± â†“, ëŒ€í‘œì„± â†‘, ì¡°ì‘ì„± â†‘
- ì±…ì„ì„±(Accountability): íŒŒí¸ì„± ë†’ì„ìˆ˜ë¡ ì—°ë¦½ì •ë¶€ â†’ ì±…ì„ì†Œì¬ ë¶ˆëª…í™•
- ì‘ë‹µì„±(Responsiveness): ì—°ë¦½ì •ë¶€ í•©ì˜ ì–´ë ¤ì›€ â†’ ì •ì±…ê²°ì • ì§€ì—°
- ëŒ€í‘œì„±(Representativeness): ì†Œìˆ˜ì •ë‹¹ ì›ë‚´ ì§„ì¶œ â†’ ë‹¤ì–‘í•œ ì´ìµ ëŒ€ë³€

ì„ ê±°ì œë„ ìœ í˜•:
- ì†Œì„ ê±°êµ¬ì œ: íŒŒí¸ì„± ê°€ì¥ ë‚®ìŒ (ì–‘ë‹¹ì œ)
- ì¤‘ëŒ€ì„ ê±°êµ¬ ë‹¤ìˆ˜ëŒ€í‘œì œ: ì¤‘ê°„ ìˆ˜ì¤€
- ë¹„ë¡€ëŒ€í‘œì œ: íŒŒí¸ì„± ê°€ì¥ ë†’ìŒ (ë‹¤ë‹¹ì œ)

ë™ì‹œì„ ê±° íš¨ê³¼:
- ëŒ€ì„ ê³¼ ì´ì„  ë™ì‹œ ì‹¤ì‹œ ì‹œ ì•¼ê¶Œ ë‹¨ê²° â†’ íŒŒí¸ì„± ê°ì†Œ
- í˜„ì§ ëŒ€í†µë ¹ ì¬ì„  í—ˆìš© + ë™ì‹œì„ ê±° = íŒŒí¸ì„± ê°ì†Œ íš¨ê³¼ ê·¹ëŒ€í™”

ì‚¬ë¥´í† ë¦¬(Sartori) ì •ë‹¹ì²´ì œ ë¶„ë¥˜:
- ì¼ë‹¹ìš°ìœ„ì œ, ì–‘ë‹¹ì œ, ì˜¨ê±´ë‹¤ë‹¹ì œ, ê·¹ë‹¨ë‹¤ë‹¹ì œ, ì›ìí™” ì •ë‹¹ì²´ì œ
- ì´ë…ì  ê±°ë¦¬ì™€ ì›ì‹¬ì /êµ¬ì‹¬ì  ê²½ìŸ ê°œë…
`,

  'ë¯¼ì£¼ì£¼ì˜í‡´í–‰': `
ë‚¸ì‹œ ë²„ë©”ì˜¤(Nancy Bermeo), ë¯¼ì£¼ì£¼ì˜ í‡´í–‰:
- êµ¬ ê¶Œìœ„ì£¼ì˜ íŠ¹ì§• ê°ì†Œ: ì¿ ë°íƒ€, í–‰ì • ì¿ ë°íƒ€(ì¹œìœ„ ì¿ ë°íƒ€), ë¶€ì •ì„ ê±°
- ìƒˆë¡œìš´ í‡´í–‰ ìœ í˜• 3ê°€ì§€:
  1. ì•½ì† ì¿ ë°íƒ€(Promissory coup): ë¯¼ì£¼ì£¼ì˜ ë³µì› ì•½ì† í›„ ì´í–‰ ì•ˆ í•¨
  2. í–‰ì •ë ¥ ê°•í™”(Executive aggrandizement): ì˜íšŒÂ·ì‚¬ë²•ë¶€Â·ì–¸ë¡  ì•½í™”, ê³ ë°œë¡œ ì •ì  ì œê±°
  3. ì „ëµì  ì„ ê±° ì¡°ì‘(Strategic election manipulation): ì„ ê´€ìœ„Â·ì–¸ë¡  í†µì œ

í¬í“°ë¦¬ì¦˜ê³¼ ë¯¼ì£¼ì£¼ì˜ í‡´í–‰:
- Ghia Nodia: í¬í“°ë¦¬ìŠ¤íŠ¸ = ì§„ì •í•œ ë¯¼ì˜ ëŒ€ë³€ ì£¼ì¥, ì‹¤ì œë¡œëŠ” 1ì¸ ì§‘ì¤‘ ëŒ€ì˜ì œ
- ì§ì ‘ ë¯¼ì£¼ì£¼ì˜ì™€ ê±°ë¦¬ ë©€ì–´ì§, ì¤‘ê°„ ì œë„ ë¬´ì‹œ

ë¯¼ì£¼ì£¼ì˜ í‡´í–‰ ì›ì¸ ì´ë¡ :
1. ì—ì´ì „ì‹œ ê¸°ë°˜ ì´ë¡ : ì •ì¹˜ í–‰ìœ„ìì˜ ìš°ë°œì  ê²°ì • (êµ¬ì¡° ê°„ê³¼)
2. ì •ì¹˜ë¬¸í™” ì´ë¡ : ë¬¸í™” ë³€ìˆ˜ (ë‹¨ê¸° ë³€í™” ì„¤ëª… ì–´ë ¤ì›€)
3. ì •ì¹˜ì œë„ ì´ë¡ : ëŒ€í†µë ¹ì œ vs ì˜íšŒì œ ì°¨ì´ (í†µê³„ì  ìœ ì˜ì„± ë¶€ì¡±)
4. ì •ì¹˜ê²½ì œí•™ ì´ë¡ : ë¶ˆí‰ë“± ì‹¬í™”, ì¤‘ì‚°ì¸µ ë¶•ê´´ (í†µê³„ì  ìœ ì˜ì„± ë¶€ì¡±)
5. ì‚¬íšŒêµ¬ì¡°ì™€ ì •ì¹˜ì—°í•© ì´ë¡ 

ì •ì¹˜ì  ì–‘ê·¹í™”(McCoy, Rahman, Somer):
- ì „ ì„¸ê³„ ë¯¼ì£¼ì£¼ì˜ í‡´í–‰ì˜ ì£¼ìš” íŒ¨í„´
- í¬í“°ë¦¬ìŠ¤íŠ¸ ì§€ë„ì ë“±ì¥ê³¼ ì–‘ê·¹í™” ì•…ìˆœí™˜

ë¯¼ì£¼í™” ì´ë¡ :
- ëª¨ë”ë‹ˆì œì´ì…˜(Modernization) ì´ë¡ : ê²½ì œ ë°œì „ â†’ ë¯¼ì£¼í™” (ë¦½ì…‹)
- ì—˜ë¦¬íŠ¸ í˜‘ì•½(Elite Pact) ì´ë¡ : êµ¬ ì—˜ë¦¬íŠ¸ì™€ ë¯¼ì£¼í™” ì„¸ë ¥ ê°„ í˜‘ìƒ
- ì‚¬íšŒêµ¬ì¡° ì´ë¡ : ë¶€ë¥´ì£¼ì•„ì§€ì™€ ë…¸ë™ê³„ê¸‰ì˜ ì—­í•  (ë¬´ì–´, ë£¨ì‡¼ë§ˆì´ì–´)
`,

  'ì •ì¹˜ì œë„': `
ì •ë‹¹(Political Party):
- ì‚¬ë¥´í† ë¦¬ ì •ì˜: ì„ ê±°ì—ì„œ ê³µì‹ ë¼ë²¨ë¡œ ì¸ì‹, ê³µì§ì„ ëª©í‘œë¡œ í›„ë³´ ë°°ì¹˜ ëŠ¥ë ¥
- ì •ë‹¹ ê¸°ëŠ¥: ì •ì¹˜ì  ì¶©ì›, ì •ê¶Œ ë‹´ë‹¹Â·ê²¬ì œ, ì´ìµ ì§‘ì•½Â·ì¡°ì •, ëŒ€í‘œ ê¸°ëŠ¥, ì˜ì‚¬í‘œí˜„ ê¸°ëŠ¥

ì œë„ì£¼ì˜(Institutionalism):
- êµ¬ ì œë„ì£¼ì˜(Old): ê³µì‹ì Â·ë²•ì  ì œë„ ì¤‘ì‹¬, ì •íƒœì , ê¸°ìˆ ì 
- ì‹  ì œë„ì£¼ì˜(New): ë¹„ê³µì‹ ì œë„ í¬í•¨, ì œë„ê°€ í–‰ìœ„ì ì„ í˜¸ì™€ í–‰ë™ì„ í˜•ì„±

ì—­ì‚¬ì  ì œë„ì£¼ì˜(Historical Institutionalism):
- ê²½ë¡œì˜ì¡´ì„±(Path Dependency): ì´ˆê¸° ì„ íƒì´ ì´í›„ ì œë„ ë°œì „ ì œì•½
- ê²°ì •ì  ë¶„ê¸°ì (Critical Juncture): ì œë„ ë³€í™”ì˜ ê³„ê¸°
- ë¹„íš¨ìœ¨ì  ì œë„ë„ ì§€ì†ë  ìˆ˜ ìˆìŒ

í•©ë¦¬ì  ì„ íƒ ì œë„ì£¼ì˜(Rational Choice Institutionalism):
- ì œë„ = í–‰ìœ„ì ê°„ ì „ëµì  ìƒí˜¸ì‘ìš©ì˜ ê²°ê³¼
- ì œë„ëŠ” ë¶ˆí™•ì‹¤ì„± ê°ì†Œ, ê±°ë˜ë¹„ìš© ì ˆê°
- ê³µì‹ì  ê·œì¹™ ê°•ì¡°

ì‚¬íšŒí•™ì  ì œë„ì£¼ì˜(Sociological Institutionalism):
- ì œë„ëŠ” ë¬¸í™”Â·ì¸ì§€ì  ìš”ì†Œ í¬í•¨
- ì •ë‹¹ì„±(Legitimacy) í™•ë³´ë¥¼ ìœ„í•œ ë™í˜•í™”(Isomorphism)

ê±°ë¶€ê¶Œ í–‰ìœ„ì(Veto Player, Tsebelis):
- í˜„ìƒ ìœ ì§€ ë³€ê²½ì„ ìœ„í•´ ë™ì˜ê°€ í•„ìš”í•œ í–‰ìœ„ì
- ê±°ë¶€ê¶Œ í–‰ìœ„ì ìˆ˜ â†‘ â†’ ì •ì±… ë³€í™” ì–´ë ¤ì›€ (ì •ì±… ì•ˆì •ì„± â†‘)
- ì œë„ì  ê±°ë¶€ê¶Œ í–‰ìœ„ì vs ë‹¹íŒŒì  ê±°ë¶€ê¶Œ í–‰ìœ„ì

ì—°ë°©ì œì™€ ì–‘ì›ì œ(Federalism & Bicameralism):
- ì—°ë°©ì œ: ì¤‘ì•™Â·ì§€ë°© ê°„ ê¶Œí•œ ë¶„ì‚°
- ì–‘ì›ì œ: ê±°ë¶€ê¶Œ í–‰ìœ„ì ì¦ê°€ íš¨ê³¼

í•©ì˜ì œ ë¯¼ì£¼ì£¼ì˜(Consociationalism, Lijphart):
- ë¶„ì ˆëœ ì‚¬íšŒì˜ ë¯¼ì£¼ì£¼ì˜ ì•ˆì •í™”
- ëŒ€ì—°í•©, ìƒí˜¸ ê±°ë¶€ê¶Œ, ë¹„ë¡€ì„±, ë¶„ì ˆ ììœ¨ì„±
`,

  'ë¹„êµê¶Œìœ„ì£¼ì˜': `
ê¶Œìœ„ì£¼ì˜ ì²´ì œ ìœ í˜•:
- ê°œì¸ë…ì¬(Personalism): ì§€ë„ì ê°œì¸ì— ê¶Œë ¥ ì§‘ì¤‘
- êµ°ì‚¬ë…ì¬(Military Junta): êµ°ë¶€ ì§‘ë‹¨ í†µì¹˜
- ë‹¨ì¼ì •ë‹¹ì œ(Single Party): í•˜ë‚˜ì˜ ì •ë‹¹ì´ ê¶Œë ¥ ë…ì 
- êµ°ì£¼ì œ(Monarchy): ì™•ì¡°ì— ì˜í•œ í†µì¹˜
- í˜¼í•©í˜•(Hybrid): ë³µìˆ˜ ìš”ì†Œ ê²°í•©

ê¶Œìœ„ì£¼ì˜ ë‚´êµ¬ì„±(Durability):
- ê¶Œë ¥ ë¶„ë°° ë©”ì»¤ë‹ˆì¦˜: ì—˜ë¦¬íŠ¸ì—ê²Œ ì§€ëŒ€(rent) ë°°ë¶„
- ì–µì••(Repression) vs í¬ìš©(Inclusion) ì „ëµ
- ì„ ê±° ì‹¤ì‹œ: ì •ë³´ ìˆ˜ì§‘, ì •ë‹¹ì„± í™•ë³´, ì—˜ë¦¬íŠ¸ í†µì œ ë„êµ¬
- ì¿ ë°íƒ€ ë°©ì§€: ì—­ê· í˜•(Counterbalancing) ì „ëµ

ì„ ê±° ê¶Œìœ„ì£¼ì˜(Electoral Authoritarianism, Schedler):
- ë‹¤ë‹¹ì„ ê±° ì‹¤ì‹œí•˜ì§€ë§Œ ë¶ˆê³µì •
- ê²½ìŸì  ê¶Œìœ„ì£¼ì˜(Competitive Authoritarianism, Levitsky & Way)
- í—¤ê²Œëª¨ë‹‰ ì„ ê±° ê¶Œìœ„ì£¼ì˜ vs ê²½ìŸì  ê¶Œìœ„ì£¼ì˜

í˜¼í•©ì²´ì œ(Hybrid Regime):
- ë¯¼ì£¼ì£¼ì˜ì™€ ê¶Œìœ„ì£¼ì˜ í˜¼í•©
- ì¼ë¦¬ë²„ëŸ´ ë¯¼ì£¼ì£¼ì˜(Illiberal Democracy)
- ê²Œë„ íŒŒë¥´ë„ì‹œ(Diamond): ì„ ê±°ë¯¼ì£¼ì£¼ì˜ì™€ ììœ ë¯¼ì£¼ì£¼ì˜ êµ¬ë¶„

ê¶Œìœ„ì£¼ì˜ ë¶•ê´´ ì›ì¸:
- ê²½ì œ ìœ„ê¸°, ì—˜ë¦¬íŠ¸ ë¶„ì—´, ëŒ€ì¤‘ ë™ì›, ì™¸ë¶€ ì••ë ¥
- ë‚´ë¶€ ììœ í™”(Liberalization) vs ë¯¼ì£¼í™”(Democratization)
`,

  'ë¯¼ì£¼í™”ì´ë¡ ': `
ëª¨ë”ë‹ˆì œì´ì…˜ ì´ë¡ (Modernization Theory):
- ë¦½ì…‹(Lipset): ê²½ì œ ë°œì „ â†’ ì¤‘ì‚°ì¸µ ì„±ì¥ â†’ ë¯¼ì£¼ì£¼ì˜ ì••ë ¥
- ì†Œë“ìˆ˜ì¤€ê³¼ ë¯¼ì£¼ì£¼ì˜ ì •ì  ìƒê´€ê´€ê³„
- ë¹„íŒ: ì—­ì‚¬ì  ë°˜ë¡€ ì¡´ì¬, ì¸ê³¼ê´€ê³„ ë°©í–¥ ë¶ˆëª…í™•

ë°”ë§í„´ ë¬´ì–´(Barrington Moore):
- "ë¶€ë¥´ì£¼ì•„ ì—†ì´ ë¯¼ì£¼ì£¼ì˜ ì—†ë‹¤"
- ë†ì—… ì—˜ë¦¬íŠ¸(ì§€ì£¼)ì™€ ë¶€ë¥´ì£¼ì•„ì§€ì˜ ì—­í• 
- ì„¸ ê°€ì§€ ê²½ë¡œ: ë¯¼ì£¼ì£¼ì˜, íŒŒì‹œì¦˜, ê³µì‚°ì£¼ì˜

ë£¨ì‡¼ë§ˆì´ì–´(Rueschemeyer et al.):
- ìë³¸ì£¼ì˜ ë°œì „ê³¼ ë¯¼ì£¼ì£¼ì˜: ë…¸ë™ê³„ê¸‰ì˜ ì—­í•  ê°•ì¡°
- ê³„ê¸‰ ë™ë§¹ê³¼ ê¶Œë ¥ ê· í˜•

ì „í™˜ë¡ (Transitology):
- O'Donnell & Schmitter: ë¶ˆí™•ì‹¤ì„± ì†ì˜ ì „í™˜
- ê°•ê²½íŒŒ(Hardliners) vs ì˜¨ê±´íŒŒ(Softliners) ë‚´ ë¶„ì—´
- ì—˜ë¦¬íŠ¸ í˜‘ì•½(Pact)ì˜ ì—­í• 

í—ŒíŒ…í„´(Huntington), ì œ3ì˜ ë¬¼ê²°:
- 1974~1990ë…„ëŒ€ ë¯¼ì£¼í™” ë¬¼ê²°
- ì›ì¸: ì •ë‹¹ì„± ìœ„ê¸°, ê²½ì œ ì„±ì¥, ì¢…êµ, êµ­ì œ í™˜ê²½

ë¦°ì¸ ì™€ ìŠ¤í…ŒíŒ(Linz & Stepan):
- ë¯¼ì£¼ì£¼ì˜ ê³µê³ í™”(Consolidation) ì¡°ê±´
- "ìœ ì¼í•œ ê²Œì„ ê·œì¹™"ìœ¼ë¡œ ë¯¼ì£¼ì£¼ì˜ ìˆ˜ìš©
- 5ê°œ ì˜ì—­: ì‹œë¯¼ì‚¬íšŒ, ì •ì¹˜ì‚¬íšŒ, ë²•ì¹˜, êµ­ê°€ê¸°êµ¬, ê²½ì œì‚¬íšŒ

í”„ë¥´ì œë³´ë¥´ìŠ¤í‚¤:
- ë¯¼ì£¼ì£¼ì˜ = ì¡°ì§í™”ëœ ë¶ˆí™•ì‹¤ì„±
- íŒ¨ìì˜ ì¤€ìˆ˜(Losers' Consent): ì„ ê±° ê²°ê³¼ ìˆ˜ìš©
- ì†Œë“ìˆ˜ì¤€ê³¼ ë¯¼ì£¼ì£¼ì˜ ë‚´êµ¬ì„± ê´€ê³„
`
};

// ====== INIT ======
document.getElementById('total-score').textContent = totalXP;
document.getElementById('total-correct').textContent = totalCorrect;
document.getElementById('best-streak').textContent = savedBestStreak;
updateNotebookBadge();

// Topic selection
document.querySelectorAll('.topic-card').forEach(card => {
  card.addEventListener('click', () => {
    document.querySelectorAll('.topic-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    currentTopic = card.dataset.topic;
    document.getElementById('start-btn').disabled = false;
    document.getElementById('start-btn').textContent = 'ì‹œì‘í•˜ê¸° â†’';
  });
});

// Mode selection
document.querySelectorAll('.mode-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentMode = btn.dataset.mode;
  });
});

document.getElementById('start-btn').addEventListener('click', startGame);

async function startGame() {
  if (!currentTopic) return;
  isRetryMode = false;
  totalQ = 10;
  score = 0;
  streak = 0;
  bestStreak = 0;
  correctCount = 0;
  currentQ = 0;
  questions = [];
  answered = false;

  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('game-screen').style.display = 'block';
  document.getElementById('result-screen').style.display = 'none';

  const topicNames = {
    'ë¯¼ì£¼ì£¼ì˜ê¸°ì´ˆ': 'ë¯¼ì£¼ì£¼ì˜ ê¸°ì´ˆ',
    'ì„ ê±°ì œë„ì™€ì •ë‹¹ì²´ì œ': 'ì„ ê±°ì œë„ & ì •ë‹¹ì²´ì œ',
    'ë¯¼ì£¼ì£¼ì˜í‡´í–‰': 'ë¯¼ì£¼ì£¼ì˜ í‡´í–‰',
    'ì •ì¹˜ì œë„': 'ì •ì¹˜ì œë„ë¡ ',
    'ë¹„êµê¶Œìœ„ì£¼ì˜': 'ë¹„êµê¶Œìœ„ì£¼ì˜',
    'ë¯¼ì£¼í™”ì´ë¡ ': 'ë¯¼ì£¼í™” ì´ë¡ '
  };
  document.getElementById('hud-topic').textContent = topicNames[currentTopic];
  updateHUD();
  await loadNextQuestion();
}

function updateHUD() {
  document.getElementById('streak').textContent = streak;
  document.getElementById('score').textContent = score + ' XP';
  const pct = (currentQ / totalQ) * 100;
  document.getElementById('progress-fill').style.width = pct + '%';
}

async function loadNextQuestion() {
  const area = document.getElementById('question-area');
  area.innerHTML = `
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text">ë¬¸ì œ ìƒì„± ì¤‘<span class="loading-dots"></span></div>
    </div>
  `;
  updateHUD();

  const modeInstructions = {
    'quiz': 'ì ë‹¹í•œ ë‚œì´ë„ì˜ 4ì§€ì„ ë‹¤ ë¬¸ì œë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”. ì¢…í•©ì‹œí—˜ì— ë‚˜ì˜¬ ë²•í•œ ê°œë… ì´í•´ ë¬¸ì œ.',
    'hard': 'ì–´ë µê³  ì‹¬í™”ëœ 4ì§€ì„ ë‹¤ ë¬¸ì œ. í•™ì ê°„ ì´ë¡  ë¹„êµ, ì„¸ë¶€ ë©”ì»¤ë‹ˆì¦˜, ë¹„íŒì  ì‚¬ê³  ìš”êµ¬.',
    'exam': 'ì‹¤ì œ ì¢…í•©ì‹œí—˜ ê¸°ì¶œ ìŠ¤íƒ€ì¼ë¡œ, ë…¼ë¬¸ ìˆ˜ì¤€ì˜ ê°œë…ê³¼ í•™ìë¥¼ ë¬»ëŠ” 4ì§€ì„ ë‹¤ ë¬¸ì œ.'
  };

  const alreadyAsked = questions.map(q => q.question).join('\n');
  const content = studyContent[currentTopic];

  const prompt = `ë‹¹ì‹ ì€ ì •ì¹˜í•™ ì¢…í•©ì‹œí—˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ í•™ìŠµ ìë£Œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì •ì¹˜í•™ ëŒ€í•™ì› ì¢…í•©ì‹œí—˜ ìˆ˜ì¤€ì˜ ë¬¸ì œë¥¼ ë§Œë“œì„¸ìš”.

í•™ìŠµ ìë£Œ:
${content}

ìš”êµ¬ì‚¬í•­:
- ${modeInstructions[currentMode]}
- ë°˜ë“œì‹œ 4ê°œì˜ ì„ íƒì§€ (â‘ â‘¡â‘¢â‘£)
- ì´ë¯¸ ì¶œì œëœ ë¬¸ì œì™€ ê²¹ì¹˜ì§€ ì•Šê²Œ í•´ì£¼ì„¸ìš”
- ì •ë‹µ í•´ì„¤: í•™ìëª…ê³¼ ì´ë¡ ì  ê·¼ê±° í¬í•¨ (2-3ë¬¸ì¥)

ì´ë¯¸ ì¶œì œëœ ë¬¸ì œ:
${alreadyAsked || 'ì—†ìŒ'}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´:
{
  "question": "ë¬¸ì œ ë‚´ìš©",
  "difficulty": "easy|medium|hard",
  "keyword": "í•µì‹¬ í‚¤ì›Œë“œ",
  "options": ["ì„ íƒì§€1", "ì„ íƒì§€2", "ì„ íƒì§€3", "ì„ íƒì§€4"],
  "correct": 0,
  "explanation": "í•´ì„¤",
  "scholar": "ê´€ë ¨ í•™ì"
}`;

  try {
    const response = await fetch("/.netlify/functions/claude", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-5",
        max_tokens: 1000,
        messages: [{ role: "user", content: prompt }]
      })
    });

    const data = await response.json();
    const text = data.content.map(i => i.text || "").join("");
    const clean = text.replace(/```json|```/g, "").trim();
    const q = JSON.parse(clean);
    questions.push(q);
    renderQuestion(q);
  } catch(e) {
    area.innerHTML = `<div class="error-msg">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.<br><br>
    <button onclick="loadNextQuestion()" style="margin-top:10px;background:var(--gold);border:none;color:#0d0f14;padding:10px 20px;cursor:pointer;font-family:'IBM Plex Mono',monospace;">ë‹¤ì‹œ ì‹œë„</button></div>`;
  }
}

function renderQuestion(q) {
  const letters = ['A', 'B', 'C', 'D'];
  const diffMap = { easy: 'ê¸°ì´ˆ', medium: 'ì¤‘ê¸‰', hard: 'ì‹¬í™”' };
  answered = false;

  const area = document.getElementById('question-area');
  area.innerHTML = `
    <div class="q-number">Q${currentQ + 1} / ${totalQ}</div>
    <span class="q-difficulty ${q.difficulty}">${diffMap[q.difficulty] || q.difficulty}</span>
    <div class="question-text">${q.question}</div>
    <div class="keyword-tag"># ${q.keyword}</div>
    <div class="options" id="options">
      ${q.options.map((opt, i) => `
        <button class="option-btn" onclick="selectAnswer(${i})" id="opt-${i}">
          <span class="option-letter">${letters[i]}</span>
          <span>${opt}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback-box" id="feedback">
      <div class="feedback-title" id="feedback-title"></div>
      <div class="feedback-text" id="feedback-text"></div>
      <div class="feedback-scholar" id="feedback-scholar"></div>
    </div>
    <button class="next-btn" id="next-btn" onclick="nextQuestion()">
      ${currentQ + 1 >= totalQ ? 'ê²°ê³¼ ë³´ê¸° â†’' : 'ë‹¤ìŒ ë¬¸ì œ â†’'}
    </button>
  `;
}

function selectAnswer(idx) {
  if (answered) return;
  answered = true;
  const q = questions[currentQ];
  const isCorrect = idx === q.correct;
  const letters = ['A', 'B', 'C', 'D'];

  // Disable all
  document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
  
  // Color correct/wrong
  document.getElementById(`opt-${q.correct}`).classList.add('correct');
  if (!isCorrect) {
    document.getElementById(`opt-${idx}`).classList.add('wrong');
  }

  // Scoring
  if (isCorrect) {
    streak++;
    correctCount++;
    if (streak > bestStreak) bestStreak = streak;
    const bonus = Math.min(streak - 1, 4) * 10;
    const points = 100 + bonus;
    score += points;
    showXPPop('+' + points + ' XP');

    document.getElementById('feedback-title').textContent = 'âœ“ ì •ë‹µ!';
    document.getElementById('feedback-title').className = 'feedback-title correct';
  } else {
    streak = 0;
    // Save to wrong notes (only in normal game mode, not retry mode)
    if (!isRetryMode) {
      saveWrongAnswer(q, idx, currentTopic);
    }
    document.getElementById('feedback-title').textContent = 'âœ— ì˜¤ë‹µ â€” ì˜¤ë‹µë…¸íŠ¸ì— ì €ì¥ë¨';
    document.getElementById('feedback-title').className = 'feedback-title wrong';
  }

  document.getElementById('feedback-text').textContent = q.explanation;
  document.getElementById('feedback-scholar').textContent = q.scholar ? 'ğŸ“– ' + q.scholar : '';
  document.getElementById('feedback').style.display = 'block';
  document.getElementById('next-btn').style.display = 'block';
  updateHUD();
}

function showXPPop(text) {
  const el = document.createElement('div');
  el.className = 'xp-pop';
  el.textContent = text;
  el.style.left = (Math.random() * 60 + 20) + '%';
  el.style.top = '30%';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1500);
}

function nextQuestion() {
  currentQ++;
  updateHUD();
  if (currentQ >= totalQ) {
    showResult();
  } else {
    loadNextQuestion();
  }
}

function showResult() {
  document.getElementById('game-screen').style.display = 'none';
  const result = document.getElementById('result-screen');
  result.style.display = 'flex';

  const pct = (correctCount / totalQ) * 100;
  let grade, label, comment;
  if (pct >= 90) { grade = 'A+'; label = 'íƒì›”í•œ ë‹µì•ˆ'; comment = 'ì¢…í•©ì‹œí—˜ í•©ê²© ìˆ˜ì¤€ì…ë‹ˆë‹¤! ì´ ì£¼ì œëŠ” ì™„ë²½í•˜ê²Œ ìˆ™ì§€í–ˆêµ°ìš”. ë‹¤ë¥¸ ì£¼ì œë„ ë„ì „í•´ë³´ì„¸ìš”.'; }
  else if (pct >= 80) { grade = 'A'; label = 'ìš°ìˆ˜'; comment = 'ë§¤ìš° ì˜ ì•Œê³  ìˆìŠµë‹ˆë‹¤. í‹€ë¦° ë¬¸ì œì˜ ê°œë…ì„ í•œ ë²ˆ ë” ë³µìŠµí•˜ë©´ ì™„ë²½í•  ê²ƒ ê°™ì•„ìš”.'; }
  else if (pct >= 70) { grade = 'B+'; label = 'ì–‘í˜¸'; comment = 'í•µì‹¬ ê°œë…ì€ íŒŒì•…í•˜ê³  ìˆìŠµë‹ˆë‹¤. í•™ìë“¤ì˜ ì´ë¡ ì„ ë” ì„¸ë°€í•˜ê²Œ ê³µë¶€í•´ë³´ì„¸ìš”.'; }
  else if (pct >= 60) { grade = 'B'; label = 'ë³´í†µ'; comment = 'ê¸°ë³¸ì ì¸ ë‚´ìš©ì€ ì•Œê³  ìˆì§€ë§Œ ì‹¬í™” í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤. ì˜¤ë‹µ ë…¸íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.'; }
  else { grade = 'C'; label = 'ì¬ë„ì „ í•„ìš”'; comment = 'ì´ ì£¼ì œë¥¼ ë‹¤ì‹œ í•œë²ˆ ê¼¼ê¼¼íˆ ì½ê³  ë„ì „í•´ë³´ì„¸ìš”. í•™ìŠµìë£Œë¥¼ ë‹¤ì‹œ ë¦¬ë·°í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.'; }

  const gradeColors = { 'A+': '#c9a84c', 'A': '#52c078', 'B+': '#4a90d9', 'B': '#8b5cf6', 'C': '#e05252' };
  document.getElementById('result-grade').textContent = grade;
  document.getElementById('result-grade').style.color = gradeColors[grade];
  document.getElementById('result-label').textContent = label;
  document.getElementById('r-correct').textContent = `${correctCount}/${totalQ}`;
  document.getElementById('r-score').textContent = score;
  document.getElementById('r-streak').textContent = bestStreak;
  document.getElementById('result-comment').textContent = comment;

  // Save
  totalXP += score;
  totalCorrect += correctCount;
  if (bestStreak > savedBestStreak) savedBestStreak = bestStreak;
  localStorage.setItem('totalXP', totalXP);
  localStorage.setItem('totalCorrect', totalCorrect);
  localStorage.setItem('bestStreak', savedBestStreak);
}

function goHome() {
  document.getElementById('start-screen').style.display = 'flex';
  document.getElementById('game-screen').style.display = 'none';
  document.getElementById('result-screen').style.display = 'none';
  document.getElementById('notebook-screen').style.display = 'none';
  document.getElementById('total-score').textContent = totalXP;
  document.getElementById('total-correct').textContent = totalCorrect;
  document.getElementById('best-streak').textContent = savedBestStreak;
  isRetryMode = false;
  totalQ = 10;
}

function restartGame() {
  startGame();
}
</script>
</body>
</html>
